// external script
var move = import user_script/move
var weapon = import user_script/weapon

// 変数
var chill_count = 0

var bat_count = 0
var bardiche_using = 0

var boss_count = 0
var wand_motion_count = 0
var wand_using = 0

func boss_attack()
  ?foe.hp < 600
    ?foe.distance >= 8
      weapon.equip_weapon(0)
    :
      weapon.equip_weapon(1)
      activate R
  // damage debuffは切らさない
  :?(boss_count%85 = 0 | wand_using = 1) & wand_motion_count < 16
    weapon.equip_weapon(19)
    wand_using = 1
    wand_motion_count++
  :
    wand_using = 0
    wand_motion_count = 0
    ?debuffs.count >= 5
      weapon.equip_weapon(9)
    :
      weapon.equip_weapon(10)
  boss_count++

func normal_attack()
  ?item.GetCooldown("blade") = 0 & foe.count > 5
    weapon.equip_weapon(11)
    activate R
  // ☆11 コウモリーズ
  :?foe = boss
    ?foe.distance >= 8
      ?item.GetCooldown("bash") = 0
        weapon.equip_weapon(13)
      :
        weapon.equip_weapon(0)
      chill_count++
    // 回避
    :?chill_count = 40
      weapon.equip_weapon(12)
    // chill 6
    :?chill_count < 80
      weapon.equip_weapon(9)
      chill_count++
    // デバフ考慮して閾値設定
    :?foe.hp < 600
      weapon.equip_weapon(1)
      activate R 
    :
      ?bat_count%20 = 0
        ?bardiche_using = 2
          weapon.equip_weapon(2)
          bardiche_using = 3
        :
          weapon.equip_weapon(1)
          bardiche_using = 2
      bat_count++
  // 念のため周回用
  :?debuffs.count >= 5
    ?foe.distance >= 8
      weapon.equip_weapon(0)
    :
      weapon.equip_weapon(2)
  :
    weapon.equip_weapon(10)
    // コウモリーズ用変数初期化
    chill_count = 0
    bat_count = 0
    bardiche_using = 0
  // ボス用変数初期化
  boss_count = 0
  wand_motion_count = 0
  wand_using = 0

/** 恐怖の洞窟 **/
// ボス部屋判定不可 且つ 距離判定不可
?loc = caves
  ?foe.distance >= 22
    move.walk()
  :?foe ! Bolesh
    normal_attack()
  :?foe = Bolesh
      boss_attack()
  ?hp <= 40
    activate potion